{% if ansible_os_family == 'Darwin' %}
#===== OPTIONS start =====#
# Original pf.conf may be overwritten during system updates,
# this is why it is included here:
include "/etc/pf.conf"
#====== OPTIONS end ======#

{% endif %}
{% if ansible_os_family != 'Darwin' and pf_translation != None %}
#=== TRANSLATION start ===#
rdr-anchor "drew.rdr"
load anchor "drew.rdr" from "/etc/pf.anchors/drew.rdr.rules"
#==== TRANSLATION end ====#

{% endif %}
#==== FILTERING start ====#
anchor "drew"
load anchor "drew" from "/etc/pf.anchors/drew.rules"
{% if pf_ssh_bruteforce_protect %}

anchor "drew.sshd"
load anchor "drew.sshd" from "/etc/pf.anchors/drew.sshd.rules"
{% endif %}
{% if pf_emerging_threats_protect %}

anchor "drew.eto"
load anchor "drew.eto" from "/etc/pf.anchors/drew.eto.rules"
{% endif %}
{#
SSH rule is needed only when ssh bruteforce protection is disabled.
This eliminates the issue when 'launchctl load pfctl' hangs during ansible task,
because pf blocks the ssh connection.
#}
{% if not pf_ssh_bruteforce_protect %}

# SSH (necessary for ansible management)
pass in log quick proto tcp to any port ssh flags S/SA keep state
{% endif %}
#===== FILTERING end =====#
